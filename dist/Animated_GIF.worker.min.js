(function r(a,v,n){function e(f,t){if(!v[f]){if(!a[f]){var o=typeof require=="function"&&require;if(!t&&o)return o(f,!0);if(i)return i(f,!0);var u=new Error("Cannot find module '"+f+"'");throw u.code="MODULE_NOT_FOUND",u}var l=v[f]={exports:{}};a[f][0].call(l.exports,function(r){var v=a[f][1][r];return e(v?v:r)},l,l.exports,r,a,v,n)}return v[f].exports}var i=typeof require=="function"&&require;for(var f=0;f<n.length;f++)e(n[f]);return e})({1:[function(r,a,v){function n(r){if(r<0)return 0;else if(r>255)return 255;return r}var e=[[1,49,13,61,4,52,16,64],[33,17,45,29,36,20,48,32],[9,57,5,53,12,60,8,56],[41,25,37,21,44,28,40,24],[3,51,15,63,2,50,14,62],[35,19,47,31,34,18,46,30],[11,59,7,55,10,58,6,54],[43,27,39,23,42,26,38,22]];function i(r,a,v,n,e){var i=195076;var f,t,o;var u;var l=0;var s;for(var c=0;c<e;c++){s=n[c];f=r-s[0];t=a-s[1];o=v-s[2];u=f*f+t*t+o*o;if(u<i){l=c;i=u}}return l}function f(r,a,v,f){var t=0;var o=0;var u,l,s;var c,p,h;var y=f.length;var g=e;var w=new Uint8Array(a*v);var d=8;var x=8;for(var A=0;A<v;A++){var U=A%x;for(var b=0;b<a;b++){p=g[b%d][U];u=n(r[t++]+p);l=n(r[t++]+p);s=n(r[t++]+p);h=i(u,l,s,f,y);w[o++]=h}}return w}function t(r,a,v,n){var f=0;var t=0;var o,u,l;var s;var c=n.length;var p=e;var h=a*v;var y=new Uint8Array(h);for(var g=0;g<h;g++){o=r[f++];u=r[f++];l=r[f++];y[g]=i(o,u,l,n,c)}return y}function o(r,a,v,e){var f=e.length;var t=0;var o=0;var u,l,s;var c=a-1;var p=v-1;var h,y;var g;var w,d;var x=new Uint8Array(a*v);for(var A=0;A<v;A++){for(var U=0;U<a;U++){u=n(r[t++]);l=n(r[t++]);s=n(r[t++]);var b=i(u,l,s,e,f);var m=e[b];var q=m[3];x[o]=b;var N=u-m[0];var C=l-m[1];var F=s-m[2];if(U<c){h=t+1;r[h++]+=N*7>>4;r[h++]+=C*7>>4;r[h++]+=F*7>>4}if(A<p){if(U>0){g=t-1+a;r[g++]+=N*3>>4;r[g++]+=C*3>>4;r[g++]+=F*3>>4}y=t+a;r[y++]+=N*5>>4;r[y++]+=C*5>>4;r[y++]+=F*5>>4;if(U<c){r[y++]+=N>>4;r[y++]+=C>>4;r[y++]+=F>>4}}o++}}return x}a.exports={Bayer:f,Closest:t,FloydSteinberg:o}},{}],2:[function(a,v,n){var e=a("./lib/NeuQuant");var i=a("node-dithering");function f(r){var a=[];for(var v=0;v<r.length;v++){var n=r[v];var e=(n&16711680)>>16;var i=(n&65280)>>8;var f=n&255;a.push([e,i,f,n])}return a}function t(r,a,v){var n=0;var e=a*v*4;var i=[];while(n<e){i.push(r[n++]);i.push(r[n++]);i.push(r[n++]);n++}return i}function o(r){var a=[];for(var v=0;v<r.length;v+=3){var n=r[v];var e=r[v+1];var i=r[v+2];a.push(n<<16|e<<8|i)}return a}function u(a,v,n,i){var f=t(a,v,n);var u=new e(f,f.length,i);var l=u.process();var s=new Uint32Array(o(l));var c=v*n;var p=new Uint8Array(c);var h=0;for(var y=0;y<c;y++){r=f[h++];g=f[h++];b=f[h++];p[y]=u.map(r,g,b)}return{pixels:p,palette:s}}function l(r,a,v,n,u){var l=t(r,a,v);if(u===null){var s=new e(l,l.length,16);var c=s.process();u=o(c)}var p=new Uint32Array(u);var h=f(u);var y;if(n==="closest"){y=i.Closest}else if(n==="floyd"){y=i.FloydSteinberg}else{y=i.Bayer}pixels=y(l,a,v,h);return{pixels:pixels,palette:p}}function s(r){var a=r.width;var v=r.height;var n=r.data;var e=r.dithering;var i=r.palette;var f=r.sampleInterval;if(e){return l(n,a,v,e,i)}else{return u(n,a,v,f)}}self.onmessage=function(r){var a=r.data;var v=s(a);postMessage(v)}},{"./lib/NeuQuant":3,"node-dithering":1}],3:[function(r,a,v){a.exports=function r(){var a=256;var v=499;var n=491;var e=487;var i=503;var f=3*i;var t=a-1;var o=4;var u=100;var l=16;var s=1<<l;var c=10;var p=1<<c;var h=10;var y=s>>h;var g=s<<c-h;var w=a>>3;var d=6;var x=1<<d;var A=w*x;var U=30;var b=10;var m=1<<b;var q;var N=8;var C=1<<N;var F=b+N;var O=1<<F;var B;var D;var E;var M;var Q=[];var S=[];var _=[];var I=[];function L(r,v,n){var e;var i;B=r;D=v;E=n;M=new Array(a);for(e=0;e<a;e++){M[e]=new Array(4);i=M[e];i[0]=i[1]=i[2]=(e<<o+8)/a|0;_[e]=s/a|0;S[e]=0}}function T(){var r=[];var v=new Array(a);for(var n=0;n<a;n++)v[M[n][3]]=n;var e=0;for(var i=0;i<a;i++){var f=v[i];r[e++]=M[f][0];r[e++]=M[f][1];r[e++]=M[f][2]}return r}function j(){var r;var v;var n;var e;var i;var f;var o;var u;o=0;u=0;for(r=0;r<a;r++){i=M[r];n=r;e=i[1];for(v=r+1;v<a;v++){f=M[v];if(f[1]<e){n=v;e=f[1]}}f=M[n];if(r!=n){v=f[0];f[0]=i[0];i[0]=v;v=f[1];f[1]=i[1];i[1]=v;v=f[2];f[2]=i[2];i[2]=v;v=f[3];f[3]=i[3];i[3]=v}if(e!=o){Q[o]=u+r>>1;for(v=o+1;v<e;v++){Q[v]=r}o=e;u=r}}Q[o]=u+t>>1;for(v=o+1;v<256;v++){Q[v]=t}}function k(){var r;var a;var t;var l;var s;var c;var p;var h;var y;var g;var w;var x;var b;var N;if(D<f){E=1}q=30+(E-1)/3;x=B;b=0;N=D;w=D/(3*E);g=w/u|0;h=m;c=A;p=c>>d;if(p<=1){p=0}for(r=0;r<p;r++){I[r]=h*((p*p-r*r)*C/(p*p))}if(D<f){y=3}else if(D%v!==0){y=3*v}else{if(D%n!==0){y=3*n}else{if(D%e!==0){y=3*e}else{y=3*i}}}r=0;while(r<w){t=(x[b+0]&255)<<o;l=(x[b+1]&255)<<o;s=(x[b+2]&255)<<o;a=P(t,l,s);K(h,a,t,l,s);if(p!==0){J(p,a,t,l,s)}b+=y;if(b>=N){b-=D}r++;if(g===0){g=1}if(r%g===0){h-=h/q;c-=c/U;p=c>>d;if(p<=1){p=0}for(a=0;a<p;a++){I[a]=h*((p*p-a*a)*C/(p*p))}}}}function z(r,v,n){var e;var i;var f;var t;var o;var u;var l;o=1e3;l=-1;e=Q[v];i=e-1;while(e<a||i>=0){if(e<a){u=M[e];f=u[1]-v;if(f>=o){e=a}else{e++;if(f<0){f=-f}t=u[0]-r;if(t<0){t=-t}f+=t;if(f<o){t=u[2]-n;if(t<0){t=-t}f+=t;if(f<o){o=f;l=u[3]}}}}if(i>=0){u=M[i];f=v-u[1];if(f>=o){i=-1}else{i--;if(f<0){f=-f}t=u[0]-r;if(t<0){t=-t}f+=t;if(f<o){t=u[2]-n;if(t<0){t=-t}f+=t;if(f<o){o=f;l=u[3]}}}}}return l}function G(){k();H();j();return T()}function H(){var r;var v;for(r=0;r<a;r++){M[r][0]>>=o;M[r][1]>>=o;M[r][2]>>=o;M[r][3]=r}}function J(r,v,n,e,i){var f;var t;var o;var u;var l;var s;var c;o=v-r;if(o<-1){o=-1}u=v+r;if(u>a){u=a}f=v+1;t=v-1;s=1;while(f<u||t>o){l=I[s++];if(f<u){c=M[f++];try{c[0]-=l*(c[0]-n)/O|0;c[1]-=l*(c[1]-e)/O|0;c[2]-=l*(c[2]-i)/O|0}catch(r){}}if(t>o){c=M[t--];try{c[0]-=l*(c[0]-n)/O|0;c[1]-=l*(c[1]-e)/O|0;c[2]-=l*(c[2]-i)/O|0}catch(r){}}}}function K(r,a,v,n,e){var i=M[a];var f=r/m;i[0]-=f*(i[0]-v)|0;i[1]-=f*(i[1]-n)|0;i[2]-=f*(i[2]-e)|0}function P(r,v,n){var e;var i;var f;var t;var u;var s;var p;var w;var d;var x;w=~(1<<31);d=w;s=-1;p=s;for(e=0;e<a;e++){x=M[e];i=x[0]-r;if(i<0){i=-i}f=x[1]-v;if(f<0){f=-f}i+=f;f=x[2]-n;if(f<0){f=-f}i+=f;if(i<w){w=i;s=e}t=i-(S[e]>>l-o);if(t<d){d=t;p=e}u=_[e]>>h;_[e]-=u;S[e]+=u<<c}_[s]+=y;S[s]-=g;return p}L.apply(this,arguments);var R={};R.map=z;R.process=G;return R}},{}]},{},[2]);
